---
- name: Configure GPG
  hosts: localhost
  connection: local
  vars:
    is_mac: "{{ ansible_facts['os_family'] == 'Darwin' }}"
  tasks:
    - name: Install GPG
      become: yes
      apt:
        package: "gpg"
      when: not is_mac

    - name: Create GPG configuration directory
      file:
        dest: "~/.gnupg"
        mode: 0700
        state: directory

    - name: Link files
      file:
        dest: "~/.gnupg/{{ item }}" 
        src: "~/.dotfiles/modules/gpg/{{ item }}"
        state: link
      loop:
        - "gpg.conf"
        - "git@analogrelay.net_gitsigning.public.gpg-key"
        - "andrew@stanton-nurse.com_gitsigning.public.gpg-key"

    - name: Link gpg agent config
      when: is_mac
      file:
        dest: "~/.gnupg/gpg-agent.conf"
        src: "~/.dotfiles/modules/gpg/gpg-agent.darwin.conf"
        state: link